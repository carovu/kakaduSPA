"use strict";angular.module("kakaduSpaApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngDragDrop","kakaduSpaAppServices"]).config(["$routeProvider","$httpProvider",function(a,b){b.defaults.withCredentials=!0,a.when("/",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/courses",{templateUrl:"views/courses.html",controller:"CourseListCtrl"}).when("/course/:courseId/learning",{templateUrl:"views/coursequestion.html",controller:"CourseQuestionCtrl"}).when("/favorites",{templateUrl:"views/favorites.html",controller:"FavoritesCtrl"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","$http","TokenService","AuthenticationService",function(a,b,c,d,e){d.get().success(function(a){c.defaults.headers.post["X-CSRF-Token"]=angular.fromJson(a)}).error(function(a,b){console.log("error data:"),console.log(a),console.log("error config:"),console.log(b)});var f=["/courses","/favorites"];a.$on("$routeChangeStart",function(){window._(f).contains(b.path())&&!e.isLoggedIn()&&(b.path("/login"),a.notifDanger="true",a.notification="You do not have permission. Have you tried logging in?")})}]);var kakaduServices=angular.module("kakaduSpaAppServices",["ngResource"]);kakaduServices.factory("MultipleQuestionService",function(){return{getAnswers:function(a,b){var c=[];return angular.forEach(b,function(b){c.push(a[b])}),c},getAnswerFields:function(a,b){var c=[];return angular.forEach(a,function(a,d){-1!==b.indexOf(a)&&c.push(d)}),c}}}),kakaduServices.factory("SessionService",function(){return{get:function(a){return sessionStorage.getItem(a)},set:function(a,b){return sessionStorage.setItem(a,b)},unset:function(a){return sessionStorage.removeItem(a)}}}),kakaduServices.factory("TokenService",["$http",function(a){return{get:function(){return a.get("http://dbis-fw.uibk.ac.at:6680/api/spa/token")}}}]),kakaduServices.factory("CoursesService",["$http",function(a){return{get:function(){return a.get("http://dbis-fw.uibk.ac.at:6680/api/spa/courses")},getPage:function(b,c,d,e){return a.get("http://dbis-fw.uibk.ac.at:6680/api/spa/courses?page="+b+"&per_page="+c+"&sort="+d+"&sort_dir="+e)},search:function(b){return a.get("http://dbis-fw.uibk.ac.at:6680/api/spa/courses/search?search="+b)},reset:function(b){return a.get("http://dbis-fw.uibk.ac.at:6680/api/spa/course/"+b+"/reset")}}}]),kakaduServices.factory("CourseQuestionService",["$http",function(a){return{getCourse:function(b){return a.get("http://dbis-fw.uibk.ac.at:6680/api/spa/course/"+b+"/learning")},nextQuestion:function(b){return a.post("http://dbis-fw.uibk.ac.at:6680/api/spa/learning/next",b)}}}]),kakaduServices.factory("FavoritesService",["$http",function(a){return{getFavorites:function(){return a.get("http://dbis-fw.uibk.ac.at:6680/api/spa/favorites")},add:function(b){return a.post("http://dbis-fw.uibk.ac.at:6680/api/spa/favorites/add",b)},remove:function(b){return a.post("http://dbis-fw.uibk.ac.at:6680/api/spa/favorites/remove",b)}}}]),kakaduServices.factory("AuthenticationService",["$http","$sanitize","SessionService",function(a,b,c){var d=function(){c.set("authenticated",!0)},e=function(){c.unset("authenticated")};return{login:function(b){var c=a.post("http://dbis-fw.uibk.ac.at:6680/api/spa/auth/login",JSON.stringify(b));return c.success(d),c},logout:function(){var b=a.get("http://dbis-fw.uibk.ac.at:6680/api/spa/auth/logout");return b.success(e),b},isLoggedIn:function(){return c.get("authenticated")}}}]),angular.module("kakaduSpaApp").directive("clozeQuestion",function(){return{restrict:"E",require:"ngModel",scope:{ngModel:"="},link:function(a,b){for(var c=a.ngModel.question,d=a.ngModel.answer,e=0;e<d.length;e++){var f=c.search(d[e]),g=f+d[e].length,h=c.substr(0,f),i=c.substr(g,c.length),j='<input type="text" id="answeredCloze['+e+']" style="background-color:#ababab; border:none"></input>';c=h+j+i}b.html(c),a.$watch("ngModel",function(){c=a.ngModel.question,d=a.ngModel.answer;for(var e=0;e<d.length;e++){var f=c.search(d[e]),g=f+d[e].length,h=c.substr(0,f),i=c.substr(g,c.length),j='<input type="text" id="answeredCloze['+e+']" style="background-color:#ababab; border:none"></input>';c=h+j+i}b.html(c)})}}}),angular.module("kakaduSpaApp").directive("header",function(){return{restrict:"E",templateUrl:"views/directives/header.html"}}),angular.module("kakaduSpaApp").directive("headerIndex",function(){return{restrict:"E",templateUrl:"views/directives/index-header.html"}}),angular.module("kakaduSpaApp").directive("footer",function(){return{restrict:"E",templateUrl:"views/directives/index-footer.html"}}),angular.module("kakaduSpaApp").directive("search",function(){return{restrict:"E",templateUrl:"views/directives/courses-search.html"}}),angular.module("kakaduSpaApp").directive("sorting",function(){return{restrict:"E",templateUrl:"views/directives/courses-sorting.html"}}),angular.module("kakaduSpaApp").directive("paginate",function(){return{restrict:"E",templateUrl:"views/directives/courses-pagination.html"}}),angular.module("kakaduSpaApp").directive("listCourses",function(){return{restrict:"E",templateUrl:"views/directives/courses-list.html"}}),angular.module("kakaduSpaApp").directive("searchSort",function(){return{restrict:"E",templateUrl:"views/directives/favorites-search-sort.html"}}),angular.module("kakaduSpaApp").directive("listFavorites",function(){return{restrict:"E",templateUrl:"views/directives/favorites-list.html"}}),angular.module("kakaduSpaApp").directive("progressbar",function(){return{restrict:"E",templateUrl:"views/directives/coursequestion-progressbar.html"}}),angular.module("kakaduSpaApp").directive("questiontypes",function(){return{restrict:"E",templateUrl:"views/directives/coursequestion-questiontypes.html"}}),angular.module("kakaduSpaApp").controller("LoginCtrl",["$rootScope","$scope","$location","$cookieStore","AuthenticationService","FavoritesService",function(a,b,c,d,e,f){b.credentials={email:"",password:""},b.login=function(){e.login(b.credentials).success(function(a){f.getFavorites().success(function(a){b.favorites=a,c.path(0===b.favorites.length?"/courses":"/favorites")}).error(function(a){b.notifDanger="true",b.notification=a.message}),d.put("databaseId",a.id)}).error(function(a){b.notifDanger="true",b.notification=a.message})}}]),angular.module("kakaduSpaApp").controller("CourseListCtrl",["$scope","$rootScope","$location","$http","$cookieStore","AuthenticationService","CoursesService","FavoritesService",function(a,b,c,d,e,f,g,h){a.orderProp="age",a.descript="false",a.activeCourseIndex=[],a.userId=e.get("databaseId"),a.notifSuccess="false",a.notifDanger="false",g.get().success(function(b){a.courses=b,a.currentPage=1,a.pageSize=20,a.sort="id",a.sortDir="asc",a.setCurrentPage=function(b){a.currentPage=b+1,g.getPage(a.currentPage,a.pageSize,a.sort,a.sortDir).success(function(b){a.courses=b}).error(function(b){a.notifSuccess="false",a.notifDanger="true",a.notification=b.message})},a.nextPage=function(){a.currentPage!==Math.ceil(a.courses.total/a.pageSize)&&(a.currentPage++,g.getPage(a.currentPage,a.pageSize,a.sort,a.sortDir).success(function(b){a.courses=b}).error(function(b){a.notifSuccess="false",a.notifDanger="true",a.notification=b.message}))},a.previousPage=function(){1!==a.currentPage&&(a.currentPage--,g.getPage(a.currentPage,a.pageSize,a.sort,a.sortDir).success(function(b){a.courses=b}).error(function(b){a.notifSuccess="false",a.notifDanger="true",a.notification=b.message}))},a.getNumberAsArray=function(a){return new Array(a)},a.numberOfPages=function(){return Math.ceil(a.courses.total/a.pageSize)},a.changePageSize=function(b){a.pageSize=b,g.getPage(a.currentPage,a.pageSize,a.sort,a.sortDir).success(function(b){a.courses=b}).error(function(b){a.notifSuccess="false",a.notifDanger="true",a.notification=b.message})},a.sortBy=function(b){a.sort=b,g.getPage(a.currentPage,a.pageSize,a.sort,a.sortDir).success(function(b){a.courses=b}).error(function(b){a.notifSuccess="false",a.notifDanger="true",a.notification=b.message})},a.orderBy=function(b){a.sortDir=b,g.getPage(a.currentPage,a.pageSize,a.sort,a.sortDir).success(function(b){a.courses=b}).error(function(b){a.notifSuccess="false",a.notifDanger="true",a.notification=b.message})}}).error(function(b){a.notifSuccess="false",a.notifDanger="true",a.notification=b.message}),a.search=function(b){g.search(b).success(function(b){a.courses=b,0===a.courses.total&&(a.notifSuccess="false",a.notifDanger="true",a.notification="The course does not exist.")}).error(function(b){a.notifSuccess="false",a.notifDanger="true",a.notification=b.message})},a.addFavorite=function(b,c){a.favoritemodel={id:b,type:"course"},c===!0?(a.notifSuccess="false",a.notifDanger="true",a.notification="Course has already been added to Your courses list."):h.add(a.favoritemodel).success(function(b){a.notifSuccess="true",a.notifDanger="false",a.notification="Course has been added to Your courses",a.courses=b}).error(function(b){a.notifSuccess="false",a.notifDanger="true",a.notification=b.message})},a.showDescription=function(b){a.activeCourseIndex.push(b)},a.hideDescription=function(b){-1!==a.activeCourseIndex.indexOf(b)&&a.activeCourseIndex.splice(a.activeCourseIndex.indexOf(b),1)},a.isShowing=function(b){return-1!==a.activeCourseIndex.indexOf(b)?!0:void 0},a.logOut=function(){f.logout().success(function(){c.path("/"),e.remove("databaseId")}).error(function(a){b.notifDanger="true",b.notification=a.message})}}]),angular.module("kakaduSpaApp").controller("CourseQuestionCtrl",["$rootScope","$scope","$routeParams","$http","$location","$cookieStore","AuthenticationService","CourseQuestionService","MultipleQuestionService",function(a,b,c,d,e,f,g,h,i){function j(a){for(var b,c,d=a.length;0!==d;)c=Math.floor(Math.random()*d),d-=1,b=a[d],a[d]=a[c],a[c]=b;return a}h.getCourse(c.courseId).success(function(d){b.question=d,b.checkAnswer="false",b.message="",b.notifInfo="false",b.congrats="false",100===b.question.percentage&&"false"===b.congrats&&(b.notifInfo="true",b.congrats="true",b.message="CONGRATULATIONS! Well done! You have learned all questions. You can go back to the other courses by clicking on kakadu or continue learning this course by remaining here."),"simple"===b.question.type?(b.showSimpleAnswer="false",b.simpleAnswered="false"):"multiple"===b.question.type?(b.chosenChoisesMultiple=[],b.choicesFieldNum=[],b.question.choices&&(b.rightAnswersMultiple=i.getAnswers(b.question.choices,b.question.answer)),b.showCheckMultiple="true",b.showNextMultiple="false",b.chooseButtonMultiple=[],b.shuffledChoices=j(b.question.choices),b.correctAnswerField=i.getAnswerFields(b.shuffledChoices,b.rightAnswersMultiple)):"dragdrop"===b.question.type?(b.choiceDrop="",b.shuffledChoices=j(b.question.choices)):"cloze"===b.question.type&&(b.answeredCloze=[],b.numRightGaps=0,b.showCheckCloze="true",b.showNextCloze="false",b.disableCloze=0),b.showSimple=function(){b.showSimpleAnswer="true",b.simpleAnswered="true"},b.simpleAnswerCorrect=function(){b.checkAnswer="true",b.notifInfo="true",b.message="You remembered correctly",b.simpleAnswered="false"},b.simpleAnswerWrong=function(){b.checkAnswer="false",b.notifInfo="true",b.message="You remembered wrong",b.simpleAnswered="false"},b.chooseChoiceMultiple=function(a,c){if(-1===b.choicesFieldNum.indexOf(c))b.chooseButtonMultiple[c]={"border-style":"solid","border-width":"thick"},b.choicesFieldNum.push(c),-1===b.chosenChoisesMultiple.indexOf(a)&&b.chosenChoisesMultiple.push(a);else{b.chooseButtonMultiple[c]={"background-color":"white"};for(var d=b.choicesFieldNum.length-1;d>=0;d--)b.choicesFieldNum[d]===c&&b.choicesFieldNum.splice(d,1);for(var e=b.chosenChoisesMultiple.length-1;e>=0;e--)b.chosenChoisesMultiple[e]===a&&b.chosenChoisesMultiple.splice(e,1)}},b.checkMultiple=function(){b.notifInfo="true";var a=0;b.showCheckMultiple="false",b.showNextMultiple="true",0===b.chosenChoisesMultiple.length&&a++,angular.forEach(b.chosenChoisesMultiple,function(c){-1===b.rightAnswersMultiple.indexOf(c)&&a++}),0===a?(b.checkAnswer="true",b.message="You chose correctly"):b.message="You chose wrong",angular.forEach(b.correctAnswerField,function(a){b.chooseButtonMultiple[a]=-1!==b.choicesFieldNum.indexOf(a)?{"background-color":"#dff0d8","border-style":"solid","border-width":"thick"}:{"background-color":"#dff0d8"}})},b.dropCallback=function(a,c,d){b.notifInfo="true",b.question.answer===d?(b.checkAnswer="true",b.message="You chose correctly"):b.message="You chose wrong"},b.showDraggable=function(a){return-1!==b.question.choices.indexOf(a)?!0:!1},b.checkCloze=function(){b.notifInfo="true",b.showCheckCloze="false",b.showNextCloze="true",angular.forEach(b.question.answer,function(a,c){angular.lowercase(angular.element(document.getElementById("answeredCloze["+c+"]")).val())===angular.lowercase(a)?(b.numRightGaps++,angular.element(document.getElementById("answeredCloze["+c+"]").style.backgroundColor="#9acd32")):angular.element(document.getElementById("answeredCloze["+c+"]").style.backgroundColor="#FF6347"),angular.element(document.getElementById("answeredCloze["+c+"]").setAttribute("disabled",!0))}),b.numRightGaps===b.question.answer.length?(b.checkAnswer="true",b.message="You remembered correctly"):b.message="You remembered wrong",b.disableCloze++},b.nextQuestion=function(){b.questionmodel={question:b.question.id,course:b.question.course,catalog:b.question.catalog,section:"course",answer:b.checkAnswer},h.nextQuestion(b.questionmodel).success(function(a){b.question=a,b.checkAnswer="false",b.message="",b.notifInfo="false",100===b.question.percentage&&"false"===b.congrats&&(b.notifInfo="true",b.congrats="true",b.message="CONGRATULATIONS! Well done! You have learned all questions. You can go back to the other courses by clicking on kakadu or continue learning this course by remaining here."),"simple"===b.question.type?(b.showSimpleAnswer="false",b.simpleAnswered="false"):"multiple"===b.question.type?(b.chosenChoisesMultiple=[],b.choicesFieldNum=[],b.question.choices&&(b.rightAnswersMultiple=i.getAnswers(b.question.choices,b.question.answer)),b.showCheckMultiple="true",b.showNextMultiple="false",b.chooseButtonMultiple=[],b.shuffledChoices=j(b.question.choices),b.correctAnswerField=i.getAnswerFields(b.shuffledChoices,b.rightAnswersMultiple)):"dragdrop"===b.question.type?(b.choiceDrop="",b.shuffledChoices=j(b.question.choices)):"cloze"===b.question.type&&(b.answeredCloze=[],b.numRightGaps=0,b.showCheckCloze="true",b.showNextCloze="false",b.disableCloze=0)}).error(function(b){e.path("/"),a.notifDanger="true",a.notification=b.message})},b.logOut=function(){g.logout().success(function(){f.remove("databaseId")}).error(function(b){e.path("/course/"+c.courseId+"/learning"),a.notifDanger="true",a.notification=b.message})}}).error(function(b){e.path("/"),a.notifDanger="true",a.notification=b.message+". Have you logged in?"})}]),angular.module("kakaduSpaApp").controller("FavoritesCtrl",["$scope","$rootScope","$location","$http","$cookieStore","AuthenticationService","FavoritesService","CoursesService",function(a,b,c,d,e,f,g,h){a.activeFavoriteIndex=[],a.notifInfo="false",a.notifDanger="false",g.getFavorites().success(function(b){a.favorites=b,0===a.favorites.length&&(a.notifInfo="true",a.notifDanger="false",a.notification="Your list is currently empty")}).error(function(b){a.notifInfo="false",a.notifDanger="true",a.notification=b.message}),a.orderProp="age",a.removeFavorite=function(b){a.favoritemodel={id:b,type:"course"},g.remove(a.favoritemodel).success(function(b){a.favorites=b,0===a.favorites.length&&(a.notifInfo="true",a.notifDanger="false",a.notification="Your list is currently empty")}).error(function(b){a.notifInfo="false",a.notifDanger="true",a.notification=b.message})},a.resetPercentage=function(b){h.reset(b).success(function(b){a.favorites=b}).error(function(b){a.notifInfo="false",a.notifDanger="true",a.notification=b.message})},a.logOut=function(){f.logout().success(function(){c.path("/"),e.remove("databaseId")}).error(function(c){a.notifInfo="false",b.notifDanger="true",b.notification=c.message})},a.showDescription=function(b){a.activeFavoriteIndex.push(b)},a.hideDescription=function(b){-1!==a.activeFavoriteIndex.indexOf(b)&&a.activeFavoriteIndex.splice(a.activeFavoriteIndex.indexOf(b),1)},a.isShowing=function(b){return-1!==a.activeFavoriteIndex.indexOf(b)?!0:void 0}}]),!function(a){function b(a,b){if(!(a.originalEvent.touches.length>1)){a.preventDefault();var c=a.originalEvent.changedTouches[0],d=document.createEvent("MouseEvents");d.initMouseEvent(b,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null),a.target.dispatchEvent(d)}}if(a.support.touch="ontouchend"in document,a.support.touch){var c,d=a.ui.mouse.prototype,e=d._mouseInit,f=d._mouseDestroy;d._touchStart=function(a){var d=this;!c&&d._mouseCapture(a.originalEvent.changedTouches[0])&&(c=!0,d._touchMoved=!1,b(a,"mouseover"),b(a,"mousemove"),b(a,"mousedown"))},d._touchMove=function(a){c&&(this._touchMoved=!0,b(a,"mousemove"))},d._touchEnd=function(a){c&&(b(a,"mouseup"),b(a,"mouseout"),this._touchMoved||b(a,"click"),c=!1)},d._mouseInit=function(){var b=this;b.element.bind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),e.call(b)},d._mouseDestroy=function(){var b=this;b.element.unbind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),f.call(b)}}}(jQuery);