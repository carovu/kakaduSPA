"use strict";angular.module("kakaduSpaApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngDragDrop","kakaduSpaAppServices"]).config(["$routeProvider","$httpProvider",function(a,b){b.defaults.withCredentials=!0,a.when("/",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/courses",{templateUrl:"views/courses.html",controller:"CourseListCtrl"}).when("/course/:courseId/learning",{templateUrl:"views/coursequestion.html",controller:"CourseQuestionCtrl"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","$http","TokenService","AuthenticationService",function(a,b,c,d,e){d.get().success(function(a){c.defaults.headers.post["X-CSRF-Token"]=angular.fromJson(a)}).error(function(a,b){console.log("error data:"),console.log(a),console.log("error config:"),console.log(b)});var f=["/courses"];a.$on("$routeChangeStart",function(){window._(f).contains(b.path())&&!e.isLoggedIn()&&(b.path("/login"),console.log("Please log in to continue."))})}]);var kakaduServices=angular.module("kakaduSpaAppServices",["ngResource"]);kakaduServices.factory("TokenService",["$http",function(a){return{get:function(){return a.get("http://dbis-fw.uibk.ac.at:6680/api/spa/token")}}}]),kakaduServices.factory("CoursesService",["$http",function(a){return{get:function(){return a.get("http://dbis-fw.uibk.ac.at:6680/api/spa/courses")},reset:function(b){return a.get("http://dbis-fw.uibk.ac.at:6680/api/spa/course/"+b+"/reset")}}}]),kakaduServices.factory("CourseQuestionService",["$http",function(a){return{getCourse:function(b){return a.get("http://dbis-fw.uibk.ac.at:6680/api/spa/course/"+b+"/learning")},nextQuestion:function(b){return a.post("http://dbis-fw.uibk.ac.at:6680/api/spa/learning/next",b)}}}]),kakaduServices.factory("SessionService",function(){return{get:function(a){return sessionStorage.getItem(a)},set:function(a,b){return sessionStorage.setItem(a,b)},unset:function(a){return sessionStorage.removeItem(a)}}}),kakaduServices.factory("AuthenticationService",["$http","$sanitize","SessionService",function(a,b,c){var d=function(){c.set("authenticated",!0)},e=function(){c.unset("authenticated")};return{login:function(b){var c=a.post("http://dbis-fw.uibk.ac.at:6680/api/spa/auth/login",JSON.stringify(b));return c.success(d),c},logout:function(){var b=a.get("http://dbis-fw.uibk.ac.at:6680/api/spa/auth/logout");return b.success(e),b},isLoggedIn:function(){return c.get("authenticated")}}}]),kakaduServices.factory("MultipleQuestionService",function(){return{getAnswers:function(a,b){var c=[];return angular.forEach(b,function(b){c.push(a[b])}),c}}}),angular.module("kakaduSpaApp").directive("clozeQuestion",function(){return{restrict:"E",require:"ngModel",scope:{ngModel:"="},link:function(a,b){for(var c=a.ngModel.question,d=a.ngModel.answer,e=0;e<d.length;e++){var f=c.search(d[e]),g=f+d[e].length,h=c.substr(0,f),i=c.substr(g,c.length),j='<textarea id="answeredCloze['+e+']" class="span2" rows="1" style="resize:none"></textarea>';c=h+j+i}b.html(c),a.$watch("ngModel",function(){c=a.ngModel.question,d=a.ngModel.answer;for(var e=0;e<d.length;e++){var f=c.search(d[e]),g=f+d[e].length,h=c.substr(0,f),i=c.substr(g,c.length),j='<textarea id="answeredCloze['+e+']" class="span2" rows="1" style="resize:none"></textarea>';c=h+j+i}b.html(c)})}}}),angular.module("kakaduSpaApp").controller("LoginCtrl",["$scope","$location","AuthenticationService",function(a,b,c){a.credentials={email:"",password:""},a.login=function(){c.login(a.credentials).success(function(){b.path("/courses")}).error(function(a,b){console.log("error data:"),console.log(a),console.log("error config:"),console.log(b)})}}]),angular.module("kakaduSpaApp").controller("CourseListCtrl",["$scope","$location","$route","$http","AuthenticationService","CoursesService",function(a,b,c,d,e,f){f.get().success(function(b){a.courses=b}),a.orderProp="age",a.resetPercentage=function(a){f.reset(a).success(function(){c.reload()}).error(function(a,b){console.log("error data:"),console.log(a),console.log("error config:"),console.log(b)})},a.logOut=function(){e.logout().success(function(){b.path("/")}).error(function(a,b){console.log("error data:"),console.log(a),console.log("error config:"),console.log(b)})}}]),angular.module("kakaduSpaApp").controller("CourseQuestionCtrl",["$scope","$routeParams","$http","$location","AuthenticationService","CourseQuestionService","MultipleQuestionService",function(a,b,c,d,e,f,g){function h(a){for(var b,c,d=a.length;0!==d;)c=Math.floor(Math.random()*d),d-=1,b=a[d],a[d]=a[c],a[c]=b;return a}f.getCourse(b.courseId).success(function(c){a.question=c,a.checkAnswer="false",100===a.question.percentage&&console.log("CONGRATULATIONS! Well done! You have learned all questions. You can go back to the other courses by clicking on kakadu or continue learning this course by remaining here."),"simple"===a.question.type?(a.showSimpleAnswer="false",a.simpleAnswered="false"):"multiple"===a.question.type?(a.chosenChoisesMultiple=[],a.question.choices&&(a.rightAnswersMultiple=g.getAnswers(a.question.choices,a.question.answer)),a.showCheckMultiple="true",a.showNextMultiple="false",a.chooseButtonMultiple=[]):"dragdrop"===a.question.type?a.choiceDrop="":"cloze"===a.question.type&&(a.answeredCloze=[],a.numRightGaps=0,a.shuffledAnswers=h(a.question.answer),a.showCheckCloze="true",a.showNextCloze="false"),a.showSimple=function(){a.showSimpleAnswer="true",a.simpleAnswered="true"},a.simpleAnswerCorrect=function(){a.checkAnswer="true",a.simpleAnswered="false"},a.simpleAnswerWrong=function(){a.checkAnswer="false",a.simpleAnswered="false"},a.chooseChoiceMultiple=function(b,c){a.chooseButtonMultiple[c]={"background-color":"orange"},-1===a.chosenChoisesMultiple.indexOf(b)&&a.chosenChoisesMultiple.push(b)},a.checkMultiple=function(){var b=0;a.showCheckMultiple="false",a.showNextMultiple="true",0===a.chosenChoisesMultiple.length&&b++,angular.forEach(a.chosenChoisesMultiple,function(c){-1===a.rightAnswersMultiple.indexOf(c)&&b++}),0===b&&(a.checkAnswer="true"),angular.forEach(a.question.answer,function(b){a.chooseButtonMultiple[b]={"background-color":"#dff0d8"}})},a.dropCallback=function(b,c,d){a.question.answer===d&&(a.checkAnswer="true")},a.checkCloze=function(){a.showCheckCloze="false",a.showNextCloze="true",angular.forEach(a.question.answer,function(b,c){angular.lowercase(angular.element(document.getElementById("answeredCloze["+c+"]")).val())===angular.lowercase(b)?(a.numRightGaps++,angular.element(document.getElementById("answeredCloze["+c+"]").style.backgroundColor="#9acd32")):angular.element(document.getElementById("answeredCloze["+c+"]").style.backgroundColor="#FF6347")}),a.numRightGaps===a.question.answer.length&&(a.checkAnswer="true")},a.nextQuestion=function(){a.questionmodel={question:a.question.id,course:a.question.course,catalog:a.question.catalog,section:"course",answer:a.checkAnswer},f.nextQuestion(a.questionmodel).success(function(b){a.question=b,a.checkAnswer="false",100===a.question.percentage&&console.log("CONGRATULATIONS! Well done! You have learned all questions. You can go back to the other courses by clicking on kakadu or continue learning this course by remaining here."),"simple"===a.question.type?(a.showSimpleAnswer="false",a.simpleAnswered="false"):"multiple"===a.question.type?(a.chosenChoisesMultiple=[],a.question.choices&&(a.rightAnswersMultiple=g.getAnswers(a.question.choices,a.question.answer)),a.showCheckMultiple="true",a.showNextMultiple="false",a.chooseButtonMultiple=[]):"dragdrop"===a.question.type?a.choiceDrop="":"cloze"===a.question.type&&(a.answeredCloze=[],a.numRightGaps=0,a.shuffledAnswers=h(a.question.answer),a.showCheckCloze="true",a.showNextCloze="false")}).error(function(a,b){d.path("/"),console.log("error data:"),console.log(a),console.log("error config:"),console.log(b)})},a.logOut=function(){e.logout().success(function(){}).error(function(a,c){d.path("/course/"+b.courseId+"/learning"),console.log("error data:"),console.log(a),console.log("error config:"),console.log(c)})}}).error(function(a,b){d.path("/"),console.log("Have you logged in?"),console.log("error data:"),console.log(a),console.log("error config:"),console.log(b)})}]);